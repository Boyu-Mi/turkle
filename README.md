# Turkle #

Run a clone of Amazon's Mechanical **Turk** service in your **l**ocal
**e**nvironment.

This tool is meant to be used as a web service running locally on your network
or personal machine. It will load HIT template files generated by the Amazon
Mechanical Turk web GUI provided to requesters for creating HITs. Input CSV files are
also uploaded to create a HIT based on the template with each row of
values in the CSV file.

The results of the HITs completed by the workers can be exported in CSV files.


# Installation #

Turkle works with either python 2 or python 3.

## Dependencies ##

- Turkle depends on the packages listed in `requirements.txt`.
  If the packages are not already installed in your environment, and you have
  an internet connection, then you can run the following command to install
  the required Python packages:

  ```bash
  pip install -r requirements.txt
  ```

  Using a virtual environment has the advantage of keeping the dependencies
  for this project separate from other projects. The actual syntax depends
  on what virtual environment package you are using, but it should work like this: 

  ```bash
  virtualenv venv
  source venv/bin/activate
  pip install -r requirements.txt
  ```

## Setup ##

After the dependencies have been installed, you create and initialize the db:

```bash
python manage.py migrate
python manage.py createsuperuser
```

## Configuration ##

To streamline worker task completion, submission of a HIT can
automatically load the next unfinished HIT.  To enable this setting
change `NEXT_HIT_ON_SUBMIT` to `True` at the bottom of `settings.py`
in the turkle sub-directory.

After changing settings, the web server will need to be restarted for
changes to take effect.

# Usage

The administrator loads HITs for the worker(s) to complete.
There are example HITS in the `examples` directory.
A batch of HITs consists of an HTML template and corresponding CSV data files.

## Running the server ##

```bash
python manage.py runserver
```

## Creating user accounts ##

TODO

## Loading a batch of HITs ##

TODO: documentation on using the admin UI for templates and CSVs.

## Downloading a batch of HITs ##

TODO

# Worker instructions

Use your web browser to visit [http://localhost:8000](http://localhost:8000)
Log in if you've been given user credentials.
Find your assigned set of HITs and click the "Accept next HIT" button.

# Docker usage

Instead of installing Turkle and dependencies directly, you can run Turkle as a Docker container, using scripts to manage your HIT templates and data.  Either build a Turkle image:

```bash
docker build --force-rm -t hltcoe/turkle .
```

or pull the latest from the Docker registry:

```bash
docker pull hltcoe/turkle
```

and start a container with an easy name, and mapping container port 8080 somewhere on the Docker host (e.g. 18080):

```bash
docker run -d --name container_name -p 18080:8080 hltcoe/turkle
```

Your annotator can now browse to that port on the Docker host.  To give them something to do, upload an Amazon Turk HIT template and data:

```bash
scripts/upload_hit.sh container_name data.csv template.html
```

At any point, you can download the current state of annotations:

```bash
scripts/download_annotations.sh container_name annotation_state.csv
```

You can upload new data to be annotated, without changing the template:

```bash
scripts/upload_hit.sh container_name new_data.csv
```

Or replace both:

```bash
scripts/upload_hit.sh container_name new_data.csv new_template.html
```
